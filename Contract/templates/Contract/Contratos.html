<!DOCTYPE html>
<html lang="pt-BR">

{% load static %}
{% include "includes/header.html" %}
<link rel="stylesheet" href="{% static 'Contract/css/style.css' %}">

<style>
    /* --- ESTILOS PARA A NOVA FUNCIONALIDADE --- */

    /* Estilo para a linha da tabela selecionada */
    tbody tr.selected {
        background-color: #e0efff;
        /* Cor de fundo azul claro */
        box-shadow: inset 4px 0 0 0 #007bff;
        /* Borda azul à esquerda */
    }

    /* Garante que o cursor mude para indicar que a linha é clicável */
    #template-list-tbody tr {
        cursor: pointer;
    }

    /* Container principal para os botões flutuantes */
    .fab-container {
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 100;
    }

    /* Estilo base para os botões flutuantes (FAB) */
    .fab {
        background-color: #007bff;
        color: white;
        border: none;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .fab:hover {
        background-color: #0056b3;
        transform: scale(1.05);
    }

    /* Menu de ações que aparece acima do botão principal */
    .fab-actions {
        position: absolute;
        bottom: 75px;
        right: 8px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        visibility: hidden;
        opacity: 0;
        transform: translateY(20px) scale(0.9);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* Classe para tornar o menu de ações visível */
    .fab-actions.visible {
        visibility: visible;
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    /* Estilo para os itens de ação individuais (círculos menores) */
    .fab-action-item {
        background-color: #ffffff;
        color: #555;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        /* Remove sublinhado de links */
    }

    .fab-action-item:hover {
        transform: scale(1.1);
        color: #007bff;
    }
</style>

<body>
    {% include "includes/sidebar.html" %}

    <main class="main-content">
        <div class="content-container-app">
            <header>
                <h1>Contratos</h1>
                {% include "includes/theme.html" %}
            </header>

            {% include "includes/search.html" %}

            <div class="table-container" style="width: 100% !important;">
                <table>
                    <thead>
                        <tr>
                            <th>Modelos De Contratos</th>
                            <!-- Coluna Ações foi removida -->
                        </tr>
                    </thead>
                    <tbody id="template-list-tbody">
                        {% for template in templates %}
                        <!-- Adicionados os data-attributes para o JavaScript -->
                        <tr data-pdf-url="#" data-edit-url="{% url 'Contract:edit' template.pk %}"
                            data-delete-url="{% url 'Contract:delete' template.pk %}">
                            <td>{{ template.title }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="1" class="text-center">Nenhum modelo de contrato cadastrado.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Container para os Botões Flutuantes (FAB) -->
            <div class="fab-container">
                <!-- Botão de Ações (inicialmente escondido) -->
                <div id="actions-fab-container" style="display: none;">
                    <div id="fab-actions-menu" class="fab-actions">
                        <!-- As ações serão inseridas aqui pelo JavaScript -->
                    </div>
                    <button id="actions-fab" class="fab">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                </div>

                <!-- Botão Adicionar Novo -->
                <button id="add-new-Contrato" title="Adicionar Novo Contrato" class="fab">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>
    </main>

    {% block scripts %}
    <script src="{% static 'resources/js/includes/theme.js' %}"></script>
    <script src="{% static 'resources/js/includes/subMenus.js' %}"></script>
    <script>
        // --- SCRIPT PARA A NOVA FUNCIONALIDADE DE AÇÕES ---
        document.addEventListener('DOMContentLoaded', function () {
            const tableBody = document.getElementById('template-list-tbody');
            if (!tableBody) return;

            const rows = tableBody.querySelectorAll('tr');
            const addFab = document.getElementById('add-new-Contrato');
            const actionsFabContainer = document.getElementById('actions-fab-container');
            const actionsFab = document.getElementById('actions-fab');
            const actionsMenu = document.getElementById('fab-actions-menu');

            let selectedRow = null;

            rows.forEach(row => {
                if (row.querySelector('td[colspan="1"]')) return;

                row.addEventListener('click', function () {
                    if (selectedRow === this) {
                        this.classList.remove('selected');
                        selectedRow = null;
                        showAddButton();
                    } else {
                        if (selectedRow) {
                            selectedRow.classList.remove('selected');
                        }
                        this.classList.add('selected');
                        selectedRow = this;
                        showActionsButton();
                        updateActionButtons(this);
                    }
                });
            });

            function showAddButton() {
                addFab.style.display = 'flex';
                actionsFabContainer.style.display = 'none';
                actionsMenu.classList.remove('visible');
            }

            function showActionsButton() {
                addFab.style.display = 'none';
                actionsFabContainer.style.display = 'block';
            }

            // Listener para o botão de adicionar novo contrato
            addFab.addEventListener('click', () => {
                window.location.href = '{% url "Contract:ContractCreate" %}';
            });

            // Listener para abrir/fechar o menu de ações
            actionsFab.addEventListener('click', function (event) {
                event.stopPropagation();
                actionsMenu.classList.toggle('visible');
            });

            // Listener para fechar o menu ao clicar fora
            document.addEventListener('click', function (event) {
                if (!actionsFabContainer.contains(event.target)) {
                    actionsMenu.classList.remove('visible');
                }
            });

            // Atualiza os botões de ação com base na linha selecionada
            function updateActionButtons(row) {
                const pdfUrl = row.dataset.pdfUrl;
                const editUrl = row.dataset.editUrl;
                const deleteUrl = row.dataset.deleteUrl;

                // Popula o menu com as ações, que são sempre as mesmas neste caso
                actionsMenu.innerHTML = `
                    <a href="${pdfUrl}" class="fab-action-item" title="Visualizar PDF">
                        <i class="fas fa-file-pdf"></i>
                    </a>
                    <a href="${editUrl}" class="fab-action-item" title="Editar Modelo">
                        <i class="fas fa-pencil-alt"></i>
                    </a>
                    <a href="${deleteUrl}" class="fab-action-item" title="Excluir Modelo">
                        <i class="fas fa-trash-alt"></i>
                    </a>
                `;
            }
        });
    </script>
    {% endblock %}
</body>

</html>